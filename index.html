<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calendario dell'Avvento - Costellazioni</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen p-4 overflow-y-auto relative">
  <h1 class="text-3xl font-bold mb-4 text-center">Calendario dell'Avvento - Costellazioni</h1>

  <div id="app" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"></div>

  <!-- React e ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <script>
    const { useState, useEffect } = React;

    const CONSTELLATIONS = Array.from({ length: 18 }, (_, i) => ({
      name: `Costellazione ${i+1}`,
      options: [`A`, `B`, `C`, `D`],
      description: `Descrizione della costellazione ${i+1}`,
      hints: [`Indizio 1`, `Indizio 2`, `Indizio 3`],
      image: `https://via.placeholder.com/400x300?text=Costellazione+${i+1}`
    }));

    function App() {
      const [day, setDay] = useState(18);
      const [progress, setProgress] = useState(() => JSON.parse(localStorage.getItem("progress") || "{}"));
      const [modal, setModal] = useState(null);

      useEffect(() => { localStorage.setItem("progress", JSON.stringify(progress)); }, [progress]);

      function handleAnswer(index, choice) {
        const correct = CONSTELLATIONS[index].name;
        setProgress(prev => {
          const entry = prev[index] || { attempts:0, solved:false, score:3, usedHints:0 };
          if(entry.solved) return prev;
          entry.attempts +=1;
          if(choice === correct) entry.solved=true;
          else entry.score=Math.max(0, entry.score-1);
          return { ...prev, [index]: entry };
        });
      }

      function useHint(index) {
        setProgress(prev => {
          const entry = prev[index] || { attempts:0, solved:false, score:3, usedHints:0 };
          if(entry.solved || entry.usedHints>=3) return prev;
          entry.usedHints +=1;
          entry.score=Math.max(0, entry.score-1);
          return { ...prev, [index]: entry };
        });
      }

      return React.createElement("div", null,
        CONSTELLATIONS.map((c,i) => {
          const index = i+1;
          const entry = progress[i] || { attempts:0, solved:false, score:3, usedHints:0 };
          const locked = index>day;
          return React.createElement(
            "div",
            { key:i, className:`p-4 bg-gray-800 rounded-2xl shadow-lg cursor-pointer`, onClick:()=>!locked&&setModal(i) },
            React.createElement("h2", { className:"text-xl font-bold mb-2" }, `Giorno ${index}`),
            locked ? React.createElement("p", { className:"text-gray-500" }, `ðŸ”’ Bloccato fino al giorno ${index}`)
            : !entry.solved ? React.createElement("p", null, "Rispondi per aprire")
            : React.createElement("p", { className:"text-green-400" }, `âœ… Corretto! Punti: ${entry.score}`)
          );
        }),

        modal !== null && React.createElement("div", { className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50" },
          React.createElement("div", { className:"bg-gray-900 p-6 rounded-xl max-w-lg w-full relative" },
            React.createElement("button", { className:"absolute top-2 right-2 text-xl", onClick:()=>setModal(null) }, "Ã—"),
            React.createElement("h2", { className:"text-2xl font-bold mb-2" }, CONSTELLATIONS[modal].name),
            React.createElement("img", { src: CONSTELLATIONS[modal].image, className:"w-full rounded-lg mb-4" }),
            React.createElement("p", { className:"mb-2" }, CONSTELLATIONS[modal].description),
            React.createElement("div", { className:"flex flex-col gap-2" },
              CONSTELLATIONS[modal].options.map((opt,j) => React.createElement(
                "button",
                { key:j, onClick:()=>handleAnswer(modal,opt), className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg" },
                opt
              ))
            ),
            React.createElement("div", { className:"mt-2" },
              React.createElement("button", { onClick:()=>useHint(modal), className:"text-sm text-yellow-400 underline" }, `Usa indizio (${progress[modal]?.usedHints||0}/3)`),
              progress[modal]?.usedHints>0 && React.createElement("p", { className:"mt-1 italic" }, `Indizio: ${CONSTELLATIONS[modal].hints[progress[modal].usedHints-1]}`)
            ),
            React.createElement("p", { className:"mt-2 text-sm" }, `Punti: ${progress[modal]?.score||3}`)
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("app")).render(React.createElement(App));
  </script>
</body>
</html>
