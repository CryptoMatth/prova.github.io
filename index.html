<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario dell'Avvento - Costellazioni</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">
    <h1 class="text-3xl font-bold mb-2">Calendario dell'Avvento - Costellazioni</h1>
    <div id="score" class="mb-4 text-lg text-yellow-400"></div>
    <div id="app"></div>

    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <script>
      const { useState, useEffect } = React;

      const CONSTELLATIONS = [
        {
          name: "Orione",
          options: ["Orione", "Cassiopea", "Pegaso", "Cigno"],
          description: "Orione Ã¨ una delle costellazioni piÃ¹ riconoscibili, visibile in inverno.",
          hints: [
            "Ha una famosa 'cintura' di tre stelle allineate",
            "Ãˆ legata al mito del cacciatore",
            "Ãˆ ben visibile in inverno nell'emisfero nord"
          ],
          image: "images/orione.jpg"
        },
        {
          name: "Cassiopea",
          options: ["Andromeda", "Cassiopea", "Cefeo", "Orsa Minore"],
          description: "Cassiopea Ã¨ una costellazione a forma di 'W', visibile nell'emisfero nord.",
          hints: [
            "Ha forma di W o M",
            "Ãˆ vicina all'Orsa Minore",
            "Ãˆ legata al mito della regina Cassiopea"
          ],
          image: "images/cassiopea.jpg"
        },
        {
          name: "Andromeda",
          options: ["Andromeda", "Perseo", "Pegaso", "Cigno"],
          description: "Andromeda Ã¨ famosa per la galassia di Andromeda, visibile a occhio nudo.",
          hints: [
            "Ãˆ figlia di Cassiopea nella mitologia",
            "Si trova vicino a Pegaso",
            "Ospita una delle galassie piÃ¹ vicine alla Via Lattea"
          ],
          image: "images/andromeda.jpg"
        }
        // ... continua fino a 24
      ];

      function App() {
        const simulatedDay = 18; // test: ad agosto mostra 18 giorni
        const [day, setDay] = useState(simulatedDay);
        const [progress, setProgress] = useState(() => {
          return JSON.parse(localStorage.getItem("progress") || "{}");
        });

        useEffect(() => {
          localStorage.setItem("progress", JSON.stringify(progress));
        }, [progress]);

        const totalScore = Object.values(progress).reduce((acc, e) => acc + (e.score || 0), 0);
        document.getElementById("score").innerText = `Punteggio totale: ${totalScore}`;

        function handleAnswer(index, choice) {
          const correct = CONSTELLATIONS[index].name;
          setProgress(prev => {
            const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            if (entry.solved) return prev;
            entry.attempts += 1;
            if (choice === correct) {
              entry.solved = true;
            } else {
              entry.score = Math.max(0, entry.score - 1);
            }
            return { ...prev, [index]: entry };
          });
        }

        function useHint(index) {
          setProgress(prev => {
            const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            if (entry.solved || entry.usedHints >= 3) return prev;
            entry.usedHints += 1;
            entry.score = Math.max(0, entry.score - 1);
            return { ...prev, [index]: entry };
          });
        }

        return React.createElement(
          "div",
          { className: "grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-5xl" },
          CONSTELLATIONS.map((c, i) => {
            const index = i + 1;
            const entry = progress[i] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            const locked = index > day;
            if (locked) {
              return React.createElement(
                "div",
                { key: i, className: "p-4 bg-gray-800 rounded-2xl shadow-lg" },
                React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
                React.createElement("p", { className: "text-gray-500" }, `ðŸ”’ Bloccato fino al giorno ${index}`)
              );
            }

            if (!entry.solved) {
              return React.createElement(
                "div",
                { key: i, className: "p-4 bg-gray-800 rounded-2xl shadow-lg" },
                React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
                React.createElement("img", { src: c.image, alt: c.name, className: "w-full h-40 object-contain mb-2" }),
                React.createElement("p", { className: "mb-2" }, "Quale costellazione Ã¨ questa?"),
                React.createElement(
                  "div",
                  { className: "flex flex-col gap-2" },
                  c.options.map((opt, j) =>
                    React.createElement(
                      "button",
                      {
                        key: j,
                        onClick: () => handleAnswer(i, opt),
                        className: "px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg"
                      },
                      opt
                    )
                  )
                ),
                React.createElement(
                  "div",
                  { className: "mt-2" },
                  React.createElement(
                    "button",
                    {
                      onClick: () => useHint(i),
                      className: "text-sm text-yellow-400 underline"
                    },
                    `Usa indizio (${entry.usedHints}/3)`
                  ),
                  entry.usedHints > 0 &&
                    React.createElement(
                      "p",
                      { className: "mt-1 italic" },
                      `Indizio: ${c.hints[entry.usedHints - 1]}`
                    )
                ),
                React.createElement(
                  "p",
                  { className: "mt-2 text-sm" },
                  `Punti: ${entry.score}`
                )
              );
            }

            return React.createElement(
              "div",
              { key: i, className: "p-4 bg-gray-800 rounded-2xl shadow-lg" },
              React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
              React.createElement("img", { src: c.image, alt: c.name, className: "w-full h-40 object-contain mb-2" }),
              React.createElement("p", { className: "text-green-400" }, `âœ… Corretto! Era ${c.name}.`),
              React.createElement("p", { className: "mt-1 text-sm" }, c.description),
              React.createElement("p", { className: "mt-1 text-sm" }, `Punti ottenuti: ${entry.score}`)
            );
          })
        );
      }

      ReactDOM.createRoot(document.getElementById("app")).render(React.createElement(App));
    </script>
  </body>
</html>
