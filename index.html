<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendario dell'Avvento - Costellazioni</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: -1;
    }
    .stars, .snow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      overflow: hidden;
      z-index: -1;
      pointer-events: none;
    }
    .star, .flake {
      position: absolute;
      border-radius: 50%;
      opacity: 0.8;
    }
    .star {
      width: 2px;
      height: 2px;
      background: white;
      animation: twinkle 2s infinite ease-in-out;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    .flake {
      width: 6px;
      height: 6px;
      background: white;
      opacity: 0.7;
      animation: fall linear infinite;
    }
    @keyframes fall {
      0% { transform: translateY(-10px); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translateY(100vh); opacity: 0; }
    }

    .celebration {
      animation: glow 1s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 10px #fbbf24, 0 0 20px #fbbf24; }
      to { box-shadow: 0 0 20px #f59e0b, 0 0 30px #f59e0b; }
    }

    .full-screen-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 50;
      padding: 2rem;
      overflow-y: auto;
      animation: fadeIn 0.3s ease-in-out;
    }
    .close-button {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 2rem;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
      transition: transform 0.2s ease;
    }
    .close-button:hover {
      transform: scale(1.2);
      color: #f87171;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-content {
      animation: slideUp 0.3s ease-in-out;
      max-width: 700px;
      width: 100%;
      background: #1f2937;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
    }
    .option-button {
      transition: all 0.2s ease;
    }
    .option-button:hover {
      transform: scale(1.05);
    }
    .feedback {
      margin-top: 1rem;
      font-size: 1.1rem;
      font-weight: bold;
      text-align: center;
    }
    .feedback.correct { color: #4ade80; }
    .feedback.wrong { color: #f87171; }
  </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center p-4 overflow-y-auto relative">
  <div class="overlay"></div>
  <div class="stars" id="stars"></div>
  <div class="snow" id="snow"></div>

  <h1 class="text-4xl font-extrabold mb-2 drop-shadow-lg relative z-10">üéÑ Calendario dell'Avvento - Costellazioni ‚ú®</h1>
  <h2 id="total-score" class="text-xl font-semibold mb-6 drop-shadow-lg relative z-10">‚≠ê Punteggio Totale: 0</h2>

  <div id="app" class="w-full max-w-6xl relative z-10"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script>
    // Stelle scintillanti
    const starContainer = document.getElementById('stars');
    for (let i = 0; i < 150; i++) {
      const star = document.createElement('div');
      star.classList.add('star');
      star.style.top = Math.random() * 100 + '%';
      star.style.left = Math.random() * 100 + '%';
      starContainer.appendChild(star);
    }
    // Fiocchi di neve
    const snowContainer = document.getElementById('snow');
    for (let i = 0; i < 50; i++) {
      const flake = document.createElement('div');
      flake.classList.add('flake');
      flake.style.left = Math.random() * 100 + '%';
      flake.style.animationDuration = 5 + Math.random() * 5 + 's';
      flake.style.animationDelay = Math.random() * 5 + 's';
      snowContainer.appendChild(flake);
    }

    const { useState, useEffect } = React;

¬† ¬† function shuffleArray(array) {
¬† ¬† ¬† const shuffled = [...array]; 
¬† ¬† ¬† for (let i = shuffled.length - 1; i > 0; i--) {
¬† ¬† ¬† ¬† const j = Math.floor(Math.random() * (i + 1));
¬† ¬† ¬† ¬† [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
¬† ¬† ¬† }
¬† ¬† ¬† return shuffled;
¬† ¬† }

    const CONSTELLATIONS = Array.from({ length: 31 }, (_, i) => ({
      name: `Costellazione ${i + 1}`,
      options: [`Costellazione ${i + 1}`, "Altro 1", "Altro 2", "Altro 3"],
      description: `Descrizione della costellazione ${i + 1}`,
      hints: ["Indizio 1", "Indizio 2", "Indizio 3"]
    }));

    function App() {
      const [day, setDay] = useState(18);
      const [progress, setProgress] = useState(() => JSON.parse(localStorage.getItem("progress") || "{}"));
      const [activeModal, setActiveModal] = useState(null);
      const [feedback, setFeedback] = useState("");
      const [totalScore, setTotalScore] = useState(0);

      useEffect(() => {
        localStorage.setItem("progress", JSON.stringify(progress));
        let score = 0;
        Object.values(progress).forEach(entry => {
          score += entry.score || 0;
        });
        setTotalScore(score);
      }, [progress]);

      useEffect(() => {
        document.getElementById("total-score").innerText = `‚≠ê Punteggio Totale: ${totalScore}`;
      }, [totalScore]);

      function handleAnswer(index, choice) {
        const correct = CONSTELLATIONS[index].name;
        setProgress(prev => {
          const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
          if (entry.solved) return prev;
          entry.attempts += 1;
          if (choice === correct) {
            entry.solved = true;
            setFeedback("‚úÖ Corretto! Ottimo lavoro!");
          } else {
            entry.score = Math.max(0, entry.score - 1);
            setFeedback("‚ùå Risposta sbagliata, riprova!");
          }
          return { ...prev, [index]: entry };
        });
      }

      function useHint(index) {
        setProgress(prev => {
          const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
          if (entry.solved || entry.usedHints >= 3) return prev;
          entry.usedHints += 1;
          entry.score = Math.max(0, entry.score - 1);
          setFeedback(`üí° Indizio usato: ${CONSTELLATIONS[index].hints[entry.usedHints - 1]}`);
          return { ...prev, [index]: entry };
        });
      }

      return React.createElement(
        "div",
        { className: "grid grid-cols-2 md:grid-cols-4 gap-6 w-full" },
        CONSTELLATIONS.map((c, i) => {
          const index = i + 1;
          const entry = progress[i] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
          const locked = index > day;

          function openModal() {
            if (!locked) {
              setActiveModal(i);
              setFeedback("");
            }
          }

          return React.createElement(
            "div",
            {
              key: i,
              className: `p-6 rounded-2xl shadow-xl cursor-pointer transform transition hover:scale-105 ${locked ? 'bg-gray-700 bg-opacity-70' : entry.solved ? 'celebration bg-gradient-to-br from-yellow-500 to-red-500' : 'bg-gradient-to-br from-indigo-600 to-purple-700 bg-opacity-90'}`,
              onClick: openModal
            },
            React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
            locked
              ? React.createElement("p", { className: "text-gray-300" }, `üîí Bloccato fino al giorno ${index}`)
              : React.createElement("div", { className: "text-sm text-green-300 font-semibold" },
                  entry.solved ? `üéâ Completato! ‚≠ê ${entry.score}` : "üîπ Clicca per vedere"
                )
          );
        }),
        activeModal !== null && React.createElement(
          "div",
          { className: "full-screen-modal" },
          React.createElement("button", { className: "close-button", onClick: () => setActiveModal(null) }, "√ó"),
          React.createElement("div", { className: "modal-content" },
            React.createElement("h2", { className: "text-3xl font-bold mb-4" }, `‚ú® Giorno ${activeModal + 1}`),
            React.createElement("img", { src: `images/costellazione${activeModal+1}.jpg`, alt: CONSTELLATIONS[activeModal].name, className: "mb-4 max-h-80 mx-auto rounded-lg shadow-lg" }),
            !progress[activeModal]?.solved && React.createElement(React.Fragment, null,
              React.createElement("p", { className: "mb-4 text-lg" }, "Quale costellazione √® questa?"),
              React.createElement("div", { className: "flex flex-col gap-3" },
                      shuffleArray(CONSTELLATIONS[activeModal].options).map((opt, j) =>
                      React.createElement("button", {
                          key: j,
                          onClick: () => handleAnswer(activeModal, opt),
                          className: "option-button px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg shadow"
                      }, opt)
                  )
              ),
              feedback && React.createElement("div", { className: `feedback ${feedback.includes('Corretto') ? 'correct' : feedback.includes('sbagliata') ? 'wrong' : ''}` }, feedback),
              feedback && React.createElement("div", { className: "mt-2 text-sm text-center" },
                `‚≠ê Punti rimasti: ${progress[activeModal]?.score || 0}`
              ),
              React.createElement("div", { className: "mt-4" },
                React.createElement("button", { onClick: () => useHint(activeModal), className: "text-sm text-yellow-400 underline" }, `üí° Usa indizio (${progress[activeModal]?.usedHints || 0}/3)`)
              ),
              React.createElement("p", { className: "mt-2 text-sm" }, `‚≠ê Punti: ${progress[activeModal]?.score || 3}`)
            ),
            progress[activeModal]?.solved && React.createElement("div", { className: "mt-6 text-lg space-y-4" },
              React.createElement("p", null, CONSTELLATIONS[activeModal].description),
              React.createElement("p", { className: "text-sm text-gray-300" }, `‚ùå Tentativi sbagliati: ${progress[activeModal]?.attempts - 1}`),
              React.createElement("p", { className: "text-sm text-gray-300" }, `üí° Indizi usati: ${progress[activeModal]?.usedHints}`),
              React.createElement("p", { className: "text-sm text-yellow-300 font-semibold" }, `‚≠ê Punteggio ottenuto: ${progress[activeModal]?.score}`)
            )
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("app")).render(React.createElement(App));
  </script>
</body>
</html>
