<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario dell'Avvento - Costellazioni</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: sans-serif;
      }
      #milkyWay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }
      .card {
        backdrop-filter: blur(5px);
        background-color: rgba(20, 20, 30, 0.6);
      }
    </style>
  </head>
  <body class="bg-black text-white flex flex-col items-center p-4">
    <canvas id="milkyWay"></canvas>
    <h1 class="text-3xl font-bold mb-4">Calendario dell'Avvento - Costellazioni</h1>
    <div id="app"></div>

    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <script>
      const { useState, useEffect } = React;

      const CONSTELLATIONS = Array.from({length: 31}, (_, i) => ({
        name: `Costellazione ${i+1}`,
        options: [`Opzione1`, `Opzione2`, `Opzione3`, `Opzione4`],
        description: `Informazioni su Costellazione ${i+1}`,
        hints: [`Indizio 1`, `Indizio 2`, `Indizio 3`]
      }));

      function App() {
        const [day, setDay] = useState(18); // agosto per test
        const [progress, setProgress] = useState(() => JSON.parse(localStorage.getItem('progress') || '{}'));

        useEffect(() => { localStorage.setItem('progress', JSON.stringify(progress)); }, [progress]);

        function handleAnswer(index, choice) {
          const correct = CONSTELLATIONS[index].name;
          setProgress(prev => {
            const entry = prev[index] || { attempts:0, solved:false, score:3, usedHints:0 };
            if(entry.solved) return prev;
            entry.attempts++;
            if(choice === correct) entry.solved = true;
            else entry.score = Math.max(0, entry.score-1);
            return {...prev, [index]: entry};
          });
        }

        function useHint(index) {
          setProgress(prev => {
            const entry = prev[index] || { attempts:0, solved:false, score:3, usedHints:0 };
            if(entry.solved || entry.usedHints>=3) return prev;
            entry.usedHints++;
            entry.score = Math.max(0, entry.score-1);
            return {...prev, [index]: entry};
          });
        }

        return React.createElement('div',{className:"grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-4xl"},
          CONSTELLATIONS.map((c,i)=>{
            const index = i+1;
            const entry = progress[i] || {attempts:0, solved:false, score:3, usedHints:0};
            const locked = index>day;
            if(locked) return React.createElement('div',{key:i,className:"card p-4 rounded-2xl shadow-lg"},
              React.createElement('h2',{className:"text-xl font-bold mb-2"},`Giorno ${index}`),
              React.createElement('p',{className:"text-gray-500"},`ðŸ”’ Bloccato fino al giorno ${index}`)
            );

            if(!entry.solved) return React.createElement('div',{key:i,className:"card p-4 rounded-2xl shadow-lg"},
              React.createElement('h2',{className:"text-xl font-bold mb-2"},`Giorno ${index}`),
              React.createElement('p',{className:"mb-2"},"Quale costellazione Ã¨ questa?"),
              React.createElement('div',{className:"flex flex-col gap-2"}, c.options.map((opt,j)=>
                React.createElement('button',{key:j,onClick:()=>handleAnswer(i,opt),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg"},opt)
              )),
              React.createElement('div',{className:"mt-2"},
                React.createElement('button',{onClick:()=>useHint(i),className:"text-sm text-yellow-400 underline"},`Usa indizio (${entry.usedHints}/3)`),
                entry.usedHints>0 && React.createElement('p',{className:"mt-1 italic"},`Indizio: ${c.hints[entry.usedHints-1]}`)
              ),
              React.createElement('p',{className:"mt-2 text-sm"},`Punti: ${entry.score}`)
            );

            return React.createElement('div',{key:i,className:"card p-4 rounded-2xl shadow-lg"},
              React.createElement('h2',{className:"text-xl font-bold mb-2"},`Giorno ${index}`),
              React.createElement('p',{className:"text-green-400"},`âœ… Corretto! Era ${c.name}.`),
              React.createElement('p',{className:"mt-1 text-sm"},c.description),
              React.createElement('p',{className:"mt-1 text-sm"},`Punti ottenuti: ${entry.score}`)
            );
          })
        );
      }

      ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));

      // Effetto via lattea
      const canvas = document.getElementById('milkyWay');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const stars = Array.from({length:200},()=>({x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:Math.random()*2+1, speed:Math.random()*0.2+0.05}));

      function animate(){
        ctx.fillStyle='black';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        stars.forEach(s=>{
          ctx.fillStyle='white';
          ctx.beginPath();
          ctx.arc(s.x,s.y,s.size,0,2*Math.PI);
          ctx.fill();
          s.y += s.speed;
          if(s.y>canvas.height){ s.y=0; s.x=Math.random()*canvas.width; }
        });
        requestAnimationFrame(animate);
      }
      animate();

      window.addEventListener('resize',()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});
    </script>
  </body>
</html>
