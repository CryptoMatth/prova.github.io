<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario dell'Avvento - Costellazioni</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        background-size: cover;
      }
      .star {
        position: absolute;
        background: white;
        border-radius: 50%;
      }
    </style>
  </head>
  <body class="text-white min-h-screen flex flex-col items-center p-4 relative overflow-hidden">
    <h1 class="text-3xl font-bold mb-4">Calendario dell'Avvento - Costellazioni</h1>
    <div id="app" class="relative z-10"></div>

    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <script>
      const { useState, useEffect } = React;

      // Genera stelle casuali nello sfondo
      for(let i=0;i<200;i++){
        const star = document.createElement('div');
        star.className='star';
        star.style.width = star.style.height = Math.random()*2 + 1 + 'px';
        star.style.top = Math.random()*100 + '%';
        star.style.left = Math.random()*100 + '%';
        document.body.appendChild(star);
      }

      const CONSTELLATIONS = [
        {name:"Orione", options:["Orione","Cassiopea","Pegaso","Cigno"], description:"Orione Ã¨ una delle costellazioni piÃ¹ riconoscibili, visibile in inverno.", hints:["Ha una famosa 'cintura' di tre stelle allineate","Ãˆ legata al mito del cacciatore","Ãˆ ben visibile in inverno nell'emisfero nord"]},
        {name:"Cassiopea", options:["Andromeda","Cassiopea","Cefeo","Orsa Minore"], description:"Cassiopea Ã¨ una costellazione a forma di 'W', visibile nell'emisfero nord.", hints:["Ha forma di W o M","Ãˆ vicina all'Orsa Minore","Ãˆ legata al mito della regina Cassiopea"]}
      ];

      function App(){
        const [day,setDay]=useState(18);
        const [progress,setProgress]=useState(()=>JSON.parse(localStorage.getItem('progress')||'{}'));

        useEffect(()=>{localStorage.setItem('progress',JSON.stringify(progress));},[progress]);

        function handleAnswer(index,choice){
          const correct=CONSTELLATIONS[index].name;
          setProgress(prev=>{
            const entry=prev[index]||{attempts:0,solved:false,score:3,usedHints:0};
            if(entry.solved) return prev;
            entry.attempts+=1;
            if(choice===correct){entry.solved=true;}
            else{entry.score=Math.max(0,entry.score-1);}
            return {...prev,[index]:entry};
          });
        }

        function useHint(index){
          setProgress(prev=>{
            const entry=prev[index]||{attempts:0,solved:false,score:3,usedHints:0};
            if(entry.solved||entry.usedHints>=3) return prev;
            entry.usedHints+=1;
            entry.score=Math.max(0,entry.score-1);
            return {...prev,[index]:entry};
          });
        }

        return React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-5xl"},
          CONSTELLATIONS.map((c,i)=>{
            const index=i+1;
            const entry=progress[i]||{attempts:0,solved:false,score:3,usedHints:0};
            const locked=index>day;
            if(locked){return React.createElement("div",{key:i,className:"p-4 bg-gray-800/50 backdrop-blur-lg rounded-2xl shadow-lg"},
              React.createElement("h2",{className:"text-xl font-bold mb-2"},`Giorno ${index}`),
              React.createElement("p",{className:"text-gray-400"},`ðŸ”’ Bloccato fino al giorno ${index}`)
            );}

            if(!entry.solved){return React.createElement("div",{key:i,className:"p-4 bg-gray-800/50 backdrop-blur-lg rounded-2xl shadow-lg flex flex-col items-center"},
              React.createElement("h2",{className:"text-xl font-bold mb-2"},`Giorno ${index}`),
              React.createElement("img",{src:`images/${c.name}.png`,className:"mb-2 max-h-32"}),
              React.createElement("p",{className:"mb-2"},"Quale costellazione Ã¨ questa?"),
              React.createElement("div",{className:"flex flex-col gap-2"},
                c.options.map((opt,j)=>React.createElement("button",{key:j,onClick:()=>handleAnswer(i,opt),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg"},opt))
              ),
              React.createElement("div",{className:"mt-2"},
                React.createElement("button",{onClick:()=>useHint(i),className:"text-sm text-yellow-400 underline"},`Usa indizio (${entry.usedHints}/3)`),
                entry.usedHints>0&&React.createElement("p",{className:"mt-1 italic"},`Indizio: ${c.hints[entry.usedHints-1]}`)
              ),
              React.createElement("p",{className:"mt-2 text-sm"},`Punti: ${entry.score}`)
            );}

            return React.createElement("div",{key:i,className:"p-4 bg-gray-800/50 backdrop-blur-lg rounded-2xl shadow-lg flex flex-col items-center"},
              React.createElement("h2",{className:"text-xl font-bold mb-2"},`Giorno ${index}`),
              React.createElement("img",{src:`images/${c.name}.png`,className:"mb-2 max-h-32"}),
              React.createElement("p",{className:"text-green-400"},`âœ… Corretto! Era ${c.name}.`),
              React.createElement("p",{className:"mt-1 text-sm"},c.description),
              React.createElement("p",{className:"mt-1 text-sm"},`Punti ottenuti: ${entry.score}`)
            );
          })
        );
      }

      ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
    </script>
  </body>
</html>
