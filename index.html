<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario dell'Avvento - Costellazioni</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: radial-gradient(ellipse at bottom, #0d0d1a 0%, #000 100%);
        background-image: url('https://i.imgur.com/3r8KZ7k.jpg'); /* stellato o galassia */
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
      }
      .card {
        background: rgba(0, 0, 20, 0.7);
        backdrop-filter: blur(5px);
        border-radius: 1rem;
      }
      .button {
        transition: transform 0.2s;
      }
      .button:hover {
        transform: scale(1.05);
      }
    </style>
  </head>
  <body class="text-white min-h-screen flex flex-col items-center p-4">
    <h1 class="text-3xl font-bold mb-4">Calendario dell'Avvento - Costellazioni</h1>
    <div id="total-score" class="text-xl mb-4">Punteggio totale: 0</div>
    <div id="app" class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-6xl"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <script>
      const { useState, useEffect } = React;

      const CONSTELLATIONS = [];
      for (let i = 1; i <= 31; i++) {
        CONSTELLATIONS.push({
          name: `Costellazione ${i}`,
          options: [`Costellazione ${i}`, `Opzione A`, `Opzione B`, `Opzione C`],
          description: `Descrizione della Costellazione ${i}.`,
          image: `https://i.imgur.com/placeholder${i}.png`, // sostituire con immagini reali
          hints: [`Indizio 1 della Costellazione ${i}`, `Indizio 2 della Costellazione ${i}`, `Indizio 3 della Costellazione ${i}`]
        });
      }

      function App() {
        const [day, setDay] = useState(18); // simulazione giorno ad agosto
        const [progress, setProgress] = useState(() => JSON.parse(localStorage.getItem('progress') || '{}'));

        useEffect(() => { localStorage.setItem('progress', JSON.stringify(progress)); updateTotalScore(); }, [progress]);

        function handleAnswer(index, choice) {
          const correct = CONSTELLATIONS[index].name;
          setProgress(prev => {
            const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            if (entry.solved) return prev;
            entry.attempts += 1;
            if (choice === correct) entry.solved = true;
            else entry.score = Math.max(0, entry.score - 1);
            return { ...prev, [index]: entry };
          });
        }

        function useHint(index) {
          setProgress(prev => {
            const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            if (entry.solved || entry.usedHints >= 3) return prev;
            entry.usedHints += 1;
            entry.score = Math.max(0, entry.score - 1);
            return { ...prev, [index]: entry };
          });
        }

        function updateTotalScore() {
          let total = Object.values(progress).reduce((sum, e) => sum + (e.solved ? e.score : 0), 0);
          document.getElementById('total-score').innerText = `Punteggio totale: ${total}`;
        }

        return React.createElement(
          'div',
          { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-6xl' },
          CONSTELLATIONS.map((c, i) => {
            const index = i + 1;
            const entry = progress[i] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            const locked = index > day;
            if (locked) return React.createElement('div', { key: i, className: 'card p-4 shadow-lg' }, React.createElement('h2', { className: 'text-xl font-bold mb-2' }, `Giorno ${index}`), React.createElement('p', { className: 'text-gray-400' }, `ðŸ”’ Bloccato fino al giorno ${index}`));

            if (!entry.solved) {
              return React.createElement('div', { key: i, className: 'card p-4 shadow-lg flex flex-col items-center' },
                React.createElement('h2', { className: 'text-xl font-bold mb-2' }, `Giorno ${index}`),
                React.createElement('img', { src: c.image, alt: c.name, className: 'w-full h-40 object-contain mb-2 rounded-lg' }),
                React.createElement('p', { className: 'mb-2' }, 'Quale costellazione Ã¨ questa?'),
                React.createElement('div', { className: 'flex flex-col gap-2 w-full' }, c.options.map((opt,j) => React.createElement('button', { key:j, onClick:() => handleAnswer(i,opt), className:'button px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg'}, opt))),
                React.createElement('div', { className:'mt-2' },
                  React.createElement('button', { onClick:() => useHint(i), className:'text-sm text-yellow-400 underline' }, `Usa indizio (${entry.usedHints}/3)`),
                  entry.usedHints>0 && React.createElement('p',{className:'mt-1 italic'},`Indizio: ${c.hints[entry.usedHints-1]}`)
                ),
                React.createElement('p',{className:'mt-2 text-sm'},`Punti: ${entry.score}`)
              );
            }

            return React.createElement('div', { key:i, className:'card p-4 shadow-lg flex flex-col items-center' },
              React.createElement('h2',{className:'text-xl font-bold mb-2'}, `Giorno ${index}`),
              React.createElement('img',{src:c.image, alt:c.name, className:'w-full h-40 object-contain mb-2 rounded-lg'}),
              React.createElement('p',{className:'text-green-400'}, `âœ… Corretto! Era ${c.name}.`),
              React.createElement('p',{className:'mt-1 text-sm'}, c.description),
              React.createElement('p',{className:'mt-1 text-sm'}, `Punti ottenuti: ${entry.score}`)
            );
          })
        );
      }

      ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
    </script>
  </body>
</html>
