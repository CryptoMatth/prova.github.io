<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario dell'Avvento - Costellazioni</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">
    <h1 class="text-3xl font-bold mb-4">Calendario dell'Avvento - Costellazioni</h1>
    <div id="app"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <script>
      const { useState, useEffect } = React;

      const CONSTELLATIONS = Array.from({ length: 24 }, (_, i) => ({
        name: `Costellazione ${i+1}`,
        options: [`Opzione A`, `Opzione B`, `Opzione C`, `Opzione D`],
        description: `Descrizione della costellazione ${i+1}.`,
        image: `images/costellazione${i+1}.jpg`,
        hints: [`Indizio 1`, `Indizio 2`, `Indizio 3`]
      }));

      function App() {
        const today = new Date();
        const currentDay = today.getMonth() === 11 ? today.getDate() : 18; // test ad agosto
        const [day, setDay] = useState(currentDay);
        const [progress, setProgress] = useState(() => JSON.parse(localStorage.getItem("progress") || "{}"));
        const [newUnlocked, setNewUnlocked] = useState([]);

        useEffect(() => {
          localStorage.setItem("progress", JSON.stringify(progress));
          const unlockedToday = CONSTELLATIONS.map((_, i) => i+1).filter(d => d === day && !(progress[d-1]?.solved));
          setNewUnlocked(unlockedToday);
        }, [progress, day]);

        function handleAnswer(index, choice) {
          const correct = CONSTELLATIONS[index].name;
          setProgress(prev => {
            const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            if (entry.solved) return prev;
            entry.attempts += 1;
            if (choice === correct) entry.solved = true;
            else entry.score = Math.max(0, entry.score - 1);
            return { ...prev, [index]: entry };
          });
        }

        function useHint(index) {
          setProgress(prev => {
            const entry = prev[index] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
            if (entry.solved || entry.usedHints >= 3) return prev;
            entry.usedHints += 1;
            entry.score = Math.max(0, entry.score - 1);
            return { ...prev, [index]: entry };
          });
        }

        const totalScore = Object.values(progress).reduce((acc, e) => acc + (e.solved ? e.score : 0), 0);

        return React.createElement(
          "div",
          { className: "w-full max-w-5xl" },
          React.createElement("p", { className: "mb-4 text-xl" }, `Punteggio totale: ${totalScore}`),
          newUnlocked.length > 0 && React.createElement("p", { className: "mb-4 text-green-300 font-bold" }, `ðŸŽ‰ Nuova domanda sbloccata oggi! Giorno ${newUnlocked[0]}`),
          React.createElement(
            "div",
            { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
            CONSTELLATIONS.map((c, i) => {
              const index = i + 1;
              const entry = progress[i] || { attempts: 0, solved: false, score: 3, usedHints: 0 };
              const locked = index > day;

              if (locked) return React.createElement("div", { key: i, className: "p-4 bg-gray-800 rounded-2xl shadow-lg" },
                React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
                React.createElement("p", { className: "text-gray-500" }, `ðŸ”’ Bloccato fino al giorno ${index}`)
              );

              if (!entry.solved) return React.createElement("div", { key: i, className: "p-4 bg-gray-800 rounded-2xl shadow-lg" },
                React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
                React.createElement("img", { src: c.image, alt: c.name, className: "mb-2 rounded-lg" }),
                React.createElement("p", { className: "mb-2" }, "Quale costellazione Ã¨ questa?"),
                React.createElement("div", { className: "flex flex-col gap-2" },
                  c.options.map((opt, j) => React.createElement("button", { key: j, onClick: () => handleAnswer(i, opt), className: "px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg" }, opt))
                ),
                React.createElement("div", { className: "mt-2" },
                  React.createElement("button", { onClick: () => useHint(i), className: "text-sm text-yellow-400 underline" }, `Usa indizio (${entry.usedHints}/3)`),
                  entry.usedHints > 0 && React.createElement("p", { className: "mt-1 italic" }, `Indizio: ${c.hints[entry.usedHints - 1]}`)
                ),
                React.createElement("p", { className: "mt-2 text-sm" }, `Punti: ${entry.score}`)
              );

              return React.createElement("div", { key: i, className: "p-4 bg-gray-800 rounded-2xl shadow-lg" },
                React.createElement("h2", { className: "text-xl font-bold mb-2" }, `Giorno ${index}`),
                React.createElement("img", { src: c.image, alt: c.name, className: "mb-2 rounded-lg" }),
                React.createElement("p", { className: "text-green-400" }, `âœ… Corretto! Era ${c.name}.`),
                React.createElement("p", { className: "mt-1 text-sm" }, c.description),
                React.createElement("p", { className: "mt-1 text-sm" }, `Punti ottenuti: ${entry.score}`)
              );
            })
          )
        );
      }

      ReactDOM.createRoot(document.getElementById("app")).render(React.createElement(App));
    </script>
  </body>
</html>
